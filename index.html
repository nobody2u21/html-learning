<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Survival Advanced</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:monospace; }
#menu {
    position:fixed;
    width:100%;
    height:100%;
    background:#111;
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    color:white;
}
button { padding:15px; margin:10px; font-size:18px; cursor:pointer; }
canvas { display:none; }
#ui {
    position:fixed;
    top:10px;
    left:10px;
    color:white;
}
</style>
</head>
<body>

<div id="menu">
<h1>Mini Survival Advanced</h1>
<button onclick="startGame()">Play World</button>
<button onclick="resetWorld()">Reset World</button>
</div>

<canvas id="game"></canvas>
<div id="ui"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const TILE = 32;
let cameraX = 0;
let world = {};
let mobs = [];

let player = {
    x:100,
    y:0,
    width:28,
    height:28,
    dx:0,
    dy:0,
    onGround:false,
    health:100,
    fallStart:0,
    selected:0
};

let inventory = {
    wood:0,
    dirt:0,
    stone:0,
    plank:0,
    pickaxe:1
};

function key(x,y){ return `${x},${y}`; }

function getBlock(x,y){ return world[key(x,y)]; }

function setBlock(x,y,type){
    if(type) world[key(x,y)] = type;
    else delete world[key(x,y)];
}

function generateColumn(x){
    let ground = 12 + Math.floor(Math.sin(x*0.2)*2);

    for(let y=ground;y<20;y++){
        if(y===ground) setBlock(x,y,"grass");
        else if(y>ground+3) setBlock(x,y,"stone");
        else setBlock(x,y,"dirt");
    }

    if(Math.random()<0.08){
        for(let i=1;i<4;i++)
            setBlock(x,ground-i,"wood");
    }

    if(Math.random()<0.03){
        setBlock(x,ground+1,"lava");
    }
}

function spawnMob(x){
    mobs.push({ x:x*TILE, y:0, dx:1, health:20 });
}

function update(){
    player.dy += 0.6;

    player.x += player.dx;
    player.y += player.dy;

    let px = Math.floor(player.x/TILE);
    let py = Math.floor(player.y/TILE);

    player.onGround=false;

    if(getBlock(px,py+1)){
        player.dy=0;
        player.onGround=true;
    }

    if(!player.onGround && player.dy>0){
        if(player.fallStart===0) player.fallStart=player.y;
    }

    if(player.onGround && player.fallStart!==0){
        let fallDistance = player.y-player.fallStart;
        if(fallDistance>200){
            player.health -= Math.floor(fallDistance/20);
        }
        player.fallStart=0;
    }

    if(getBlock(px,py)==="lava"){
        player.health-=0.5;
    }

    if(player.health<=0){
        alert("You died!");
        resetWorld();
    }

    cameraX = player.x - canvas.width/2;

    for(let x=px-20;x<px+20;x++){
        if(!getBlock(x,15)) generateColumn(x);
        if(Math.random()<0.002) spawnMob(x);
    }

    mobs.forEach(m=>{
        m.x+=m.dx;
        let mx=Math.floor(m.x/TILE);
        let my=Math.floor(m.y/TILE);

        if(getBlock(mx,my+1)){
            m.y=my*TILE;
        }else{
            m.y+=5;
        }

        if(Math.abs(m.x-player.x)<30){
            player.health-=0.2;
        }
    });

    saveGame();
}

function drawBlock(x,y,type){
    if(type==="grass") ctx.fillStyle="green";
    if(type==="dirt") ctx.fillStyle="brown";
    if(type==="stone") ctx.fillStyle="gray";
    if(type==="wood") ctx.fillStyle="#8B4513";
    if(type==="lava") ctx.fillStyle="orange";
    ctx.fillRect(x*TILE-cameraX,y*TILE,TILE,TILE);
}

function draw(){
    ctx.fillStyle="skyblue";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    let px=Math.floor(player.x/TILE);

    for(let x=px-20;x<px+20;x++){
        for(let y=0;y<25;y++){
            let b=getBlock(x,y);
            if(b) drawBlock(x,y,b);
        }
    }

    ctx.fillStyle="red";
    ctx.fillRect(player.x-cameraX,player.y,player.width,player.height);

    ctx.fillStyle="purple";
    mobs.forEach(m=>{
        ctx.fillRect(m.x-cameraX,m.y,20,20);
    });

    document.getElementById("ui").innerHTML=
    `Health: ${Math.floor(player.health)}<br>
    Wood: ${inventory.wood} Dirt: ${inventory.dirt}
    Stone: ${inventory.stone}`;

    requestAnimationFrame(draw);
}

canvas.addEventListener("mousedown",e=>{
    let x=Math.floor((e.clientX+cameraX)/TILE);
    let y=Math.floor(e.clientY/TILE);

    let block=getBlock(x,y);
    if(!block) return;

    if(block==="stone" && inventory.pickaxe<1){
        alert("Need pickaxe!");
        return;
    }

    if(block==="wood") inventory.wood++;
    if(block==="dirt") inventory.dirt++;
    if(block==="stone") inventory.stone++;

    setBlock(x,y,null);
});

document.addEventListener("keydown",e=>{
    if(e.key==="a") player.dx=-4;
    if(e.key==="d") player.dx=4;
    if(e.key===" " && player.onGround) player.dy=-12;
});

document.addEventListener("keyup",e=>{
    if(e.key==="a"||e.key==="d") player.dx=0;
});

function saveGame(){
    localStorage.setItem("survivalWorld",JSON.stringify({
        world,mobs,player,inventory
    }));
}

function loadGame(){
    let data=localStorage.getItem("survivalWorld");
    if(data){
        let save=JSON.parse(data);
        world=save.world;
        mobs=save.mobs;
        player=save.player;
        inventory=save.inventory;
    }
}

function startGame(){
    document.getElementById("menu").style.display="none";
    canvas.style.display="block";
    loadGame();
    setInterval(update,30);
    draw();
}

function resetWorld(){
    localStorage.removeItem("survivalWorld");
    location.reload();
}
</script>

</body>
</html>
