<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Survival Game</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    font-family: monospace;
    background: black;
}
#menu {
    position: fixed;
    width: 100%;
    height: 100%;
    background: linear-gradient(#111, #333);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
}
button {
    padding: 15px 30px;
    margin: 10px;
    font-size: 18px;
    cursor: pointer;
}
canvas {
    display: none;
}
#crafting {
    position: fixed;
    right: 10px;
    bottom: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 10px;
    display: none;
}
</style>
</head>
<body>

<div id="menu">
<h1>Mini Survival</h1>
<button onclick="newWorld()">Create / Reset World</button>
<button onclick="loadWorld()">Play World</button>
</div>

<canvas id="game"></canvas>
<div id="crafting">
Press C to craft<br>
Wood x3 â†’ Plank
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const TILE = 32;
let cameraX = 0;

let world = {};
let inventory = { wood: 0, plank: 0 };

let player = {
    x: 100,
    y: 0,
    width: 28,
    height: 28,
    dx: 0,
    dy: 0,
    onGround: false
};

let time = 0;

function getBlock(x, y) {
    return world[`${x},${y}`];
}

function setBlock(x, y, type) {
    if (type)
        world[`${x},${y}`] = type;
    else
        delete world[`${x},${y}`];
}

function generateColumn(x) {
    let groundHeight = 10 + Math.floor(Math.sin(x * 0.2) * 2);
    for (let y = groundHeight; y < 20; y++) {
        setBlock(x, y, y === groundHeight ? "grass" : "dirt");
    }

    // tree chance
    if (Math.random() < 0.1) {
        for (let t = 1; t < 4; t++)
            setBlock(x, groundHeight - t, "wood");
    }
}

function drawBlock(x, y, type) {
    if (type === "grass") ctx.fillStyle = "green";
    if (type === "dirt") ctx.fillStyle = "brown";
    if (type === "wood") ctx.fillStyle = "#8B4513";
    if (type === "plank") ctx.fillStyle = "#c19a6b";
    ctx.fillRect(x * TILE - cameraX, y * TILE, TILE, TILE);
}

function update() {
    time += 0.002;

    player.dy += 0.5;
    player.x += player.dx;
    player.y += player.dy;

    player.onGround = false;

    let px = Math.floor(player.x / TILE);
    let py = Math.floor(player.y / TILE);

    if (getBlock(px, py + 1)) {
        player.dy = 0;
        player.onGround = true;
    }

    cameraX = player.x - canvas.width / 2;

    for (let x = px - 20; x < px + 20; x++) {
        if (!getBlock(x, 15))
            generateColumn(x);
    }
}

function draw() {
    let dayLight = Math.sin(time) * 0.5 + 0.5;
    ctx.fillStyle = `rgba(0,0,50,${1 - dayLight})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    let px = Math.floor(player.x / TILE);

    for (let x = px - 20; x < px + 20; x++) {
        for (let y = 0; y < 25; y++) {
            let block = getBlock(x, y);
            if (block)
                drawBlock(x, y, block);
        }
    }

    ctx.fillStyle = "red";
    ctx.fillRect(player.x - cameraX, player.y, player.width, player.height);

    requestAnimationFrame(draw);
}

function gameLoop() {
    update();
    saveGame();
    setTimeout(gameLoop, 30);
}

document.addEventListener("keydown", e => {
    if (e.key === "a") player.dx = -5;
    if (e.key === "d") player.dx = 5;
    if (e.key === " " && player.onGround)
        player.dy = -10;

    if (e.key === "c") {
        if (inventory.wood >= 3) {
            inventory.wood -= 3;
            inventory.plank += 1;
            alert("Crafted plank!");
        }
    }
});

document.addEventListener("keyup", e => {
    if (e.key === "a" || e.key === "d")
        player.dx = 0;
});

canvas.addEventListener("mousedown", e => {
    let x = Math.floor((e.clientX + cameraX) / TILE);
    let y = Math.floor(e.clientY / TILE);

    let block = getBlock(x, y);
    if (block) {
        if (block === "wood") inventory.wood++;
        setBlock(x, y, null);
    }
});

function saveGame() {
    localStorage.setItem("miniWorld", JSON.stringify({
        world,
        player,
        inventory,
        time
    }));
}

function loadGameData() {
    let data = localStorage.getItem("miniWorld");
    if (data) {
        let save = JSON.parse(data);
        world = save.world;
        player = save.player;
        inventory = save.inventory;
        time = save.time;
    }
}

function newWorld() {
    localStorage.removeItem("miniWorld");
    startGame();
}

function loadWorld() {
    startGame();
}

function startGame() {
    document.getElementById("menu").style.display = "none";
    canvas.style.display = "block";
    document.getElementById("crafting").style.display = "block";
    loadGameData();
    draw();
    gameLoop();
}
</script>

</body>
</html>
